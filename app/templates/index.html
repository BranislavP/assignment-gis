{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-9 map-holder">
        <div id="mapid"></div>
    </div>
    <div class="col-md-3">
        <div id="menu">
            <a href="#" class="btn btn-default" data-layer="city-borders" id="city-borders-layer" data-locked="true">City Borders</a>
            <div class="btn btn-default" id="location-setting" data-on="0">Choose location</div>
        </div>
    <div>
        <form action="" method="post" id="amenities-form">

            {{ form.hidden_tag() }}

            <div class="row">
                <div class="col-md-8">
                    <div class="form-group">
                        {{ form.distance.label }}
                        {{ form.distance(class_="form-control", size=32) }}
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="form-group">
                        {{ form.amenities.label }}
                        {{ form.amenities(class_="form-control select2", size=32)}}
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="form-group">
                        <a href="#" class="btn btn-success" id="send-amenities">Search</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
    </div>
</div>
<script src="{{url_for('static', filename='application.js')}}"></script>
<script>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

    map.on('load', function () {
        var cities = $.ajax({
            url: $SCRIPT_ROOT + "/cities_geojson",
            dataType: "json",
            error: function(xhr) {
                alert(xhr.statusText)
            }
        });
        $.when(cities).done(function() {
            map.addLayer({
                'id': 'city-borders',
                'type': 'fill',
                'source': {
                    'type': 'geojson',
                    'data': cities.responseJSON
                },
                'layout': {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-color': '#c22',
                    'fill-opacity': 0.2,
                    'fill-outline-color': '#000'
                }
            });
            $('#city-borders-layer').data('locked', 'false');
        });

        $('a#send-amenities').on('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            remove_markers();
            add_marker_points_from_geojson($SCRIPT_ROOT + '/amenities_from_point')
        });
    });
</script>
{% endblock %}
